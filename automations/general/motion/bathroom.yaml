- id: 'bathroom_on_motion'
  alias: Turn On Bathroom When Motion Detected
  description: ''
  trigger:
  - entity_id: binary_sensor.wyze_motion2
    platform: state
    to: 'on'
  condition:
    - condition: state
      entity_id: light.bathroom
      state: 'off'
  action:
  - service: var.set
    data:
      entity_id: var.bathroom_turned_on_automatically
      value_template: >-
        {% if is_state('light.bathroom', 'on') %} {{ states('var.bathroom_turned_on_automatically') }} {% else %} true {% endif %}
  - data_template:
      entity_id: >-
        {% if is_state("input_boolean.night_mode", "on") %} scene.bathroom_night {% else %} scene.bathroom_day {% endif %}
    service: scene.turn_on
  - service: var.set
    data:
      entity_id: var.bathroom_turned_on_automatically
      value_template: >-
        {% if is_state('light.guest_bathroom', 'on') %} {{ states('var.guest_bathroom_turned_on_automatically') }} {% else %} true {% endif %}
  mode: single

- id: 'bathroom_off_no_motion'
  alias: Turn Off Bathroom When Motion Cleared
  description: ''
  trigger:
    platform: state
    entity_id: binary_sensor.wyze_motion2
    to: 'off'
    for:
      minutes: >-
        {% set pee_timeout = 1 %}
        {% set poo_timeout = 30 %}
        {% if is_state("binary_sensor.bathroom_door", "off") %} {% set action = "poo" %} {% else %} {% set action = "pee" %} {% endif %}
        {% if action == "poo" %} {{ poo_timeout }} {% else %} {{ pee_timeout }} {% endif %}
  # Only turn the lights off if they were turned on automatically.
  condition:
    - condition: state
      entity_id: var.bathroom_turned_on_automatically
      state: 'true'
  action:
  - data:
      transition: 6
    service: light.turn_off
    entity_id: light.bathroom
  mode: single

- id: 'guest_bathroom_on_motion'
  alias: Turn On Guest Bathroom When Motion Detected
  description: ''
  trigger:
  - entity_id: binary_sensor.wyze_motion1
    platform: state
    to: 'on'
  condition:
    - condition: state
      entity_id: light.guest_bathroom
      state: 'off'
  action:
    - service: var.set
      data:
        entity_id: var.guest_bathroom_turned_on_automatically
        value_template: >-
          {% if is_state('light.guest_bathroom', 'on') %} {{ states('var.guest_bathroom_turned_on_automatically') }} {% else %} true {% endif %}
    - data_template:
        entity_id: >-
          {% if is_state("input_boolean.night_mode", "on") %} scene.guest_bathroom_night {% else %} scene.guest_bathroom_day {% endif %}
      service: scene.turn_on
  mode: single

- id: 'guest_bathroom_off_no_motion'
  alias: Turn Off Guest Bathroom When Motion Cleared
  description: ''
  trigger:
    platform: state
    entity_id: binary_sensor.wyze_motion1
    to: 'off'
    for:
      minutes: >-
        {% set pee_timeout = 1 %}
        {% set poo_timeout = 30 %}
        {% if is_state("binary_sensor.guest_bathroom_door", "off") %} {% set action = "poo" %} {% else %} {% set action = "pee" %} {% endif %}
        {% if action == "poo" %} {{ poo_timeout | int }} {% else %} {{ pee_timeout | int }} {% endif %}
  # Only turn the lights off if they were turned on automatically.
  condition:
    - condition: state
      entity_id: var.guest_bathroom_turned_on_automatically
      state: 'true'
  action:
  - data:
      transition: 6
    service: light.turn_off
    entity_id: light.guest_bathroom
  mode: single