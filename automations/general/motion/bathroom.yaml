- id: 'bathroom_on_motion'
  alias: Turn On Bathroom When Motion Detected
  description: ''
  trigger:
  - entity_id: binary_sensor.wyze_motion2
    platform: state
    to: 'on'
  condition: []
  action:
  - data_template:
      entity_id: >-
        {% if is_state("input_boolean.night_mode", "on") %} scene.bathroom_night {% else %} scene.bathroom_day {% endif %}
    service: scene.turn_on
  mode: single

- id: 'bathroom_off_no_motion'
  alias: Turn Off Bathroom When Motion Cleared
  description: ''
  trigger:
    platform: state
    entity_id: binary_sensor.wyze_motion2
    to: 'off'
    for:
      # TODO: Remove "and False" when door sensors are installed
      minutes: >-
        {% set pee_timeout = 1 %}
        {% set poo_timeout = 30 %}
        {% if is_state("binary_sensor.wyze_door1", "off") and False %} {% set action = "poo" %} {% else %} {% set action = "pee" %} {% endif %}
        {% if action == "poo" %} {{ poo_timeout }} {% else %} {{ pee_timeout }} {% endif %}
    # TODO: Check that they were turned on automatically.
    # If they were turned on manually, don't turn them off.
  condition: []
  action:
  - data:
      transition: 6
    service: light.turn_off
    entity_id: light.bathroom
  mode: single

- id: 'guest_bathroom_on_motion'
  alias: Turn On Guest Bathroom When Motion Detected
  description: ''
  trigger:
  - entity_id: binary_sensor.wyze_motion1
    platform: state
    to: 'on'
  condition: []
  action:
    - data_template:
        entity_id: >-
          {% if is_state("input_boolean.night_mode", "on") %} scene.guest_bathroom_night {% else %} scene.guest_bathroom_day {% endif %}
      service: scene.turn_on
  mode: single

- id: 'guest_bathroom_off_no_motion'
  alias: Turn Off Guest Bathroom When Motion Cleared
  description: ''
  trigger:
    platform: state
    entity_id: binary_sensor.wyze_motion1
    to: 'off'
    for:
      # TODO: Remove "and False" when door sensors are installed
      minutes: >-
        {% set pee_timeout = 1 %}
        {% set poo_timeout = 30 %}
        {% if is_state("binary_sensor.wyze_door2", "off") and False %} {% set action = "poo" %} {% else %} {% set action = "pee" %} {% endif %}
        {% if action == "poo" %} {{ poo_timeout | int }} {% else %} {{ pee_timeout | int }} {% endif %}
    # TODO: Check that they were turned on automatically.
    # If they were turned on manually, don't turn them off.
  condition: []
  action:
  - data:
      transition: 6
    service: light.turn_off
    entity_id: light.guest_bathroom
  mode: single