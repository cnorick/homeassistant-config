occupied:
  friendly_name: "Home Occupancy"
  device_class: occupancy
  value_template: >-
    {{ is_state('person.sarah', 'home')
      or is_state('person.nathan', 'home') }}

is_during_workday:
  value_template: >-
    {{
      states('sensor.time') > states('input_datetime.work_start_time').rsplit(':',1)[0]
      and states('sensor.time') < states('input_datetime.work_end_time').rsplit(':',1)[0]
    }}

everyone_in_bed:
  value_template: >-
    {{ 
        (
          is_state('media_player.living_room_tv', 'off')
          or is_state('media_player.living_room_tv', 'unavailable')
        )
        and (
          is_state('binary_sensor.public_space_motion', 'off')
          and states('sensor.timestamp') | float >= (states.binary_sensor.public_space_motion.last_changed | as_timestamp) + 600
        )
        and is_state('binary_sensor.bedroom_door', 'off')
        and is_state('binary_sensor.occupied', 'on')
        and (
          is_state('input_boolean.visitors', 'off')
          or (
            is_state('input_boolean.visitors', 'on') and is_state('binary_sensor.guest_bedroom_door', 'off')
          )
        )
        and is_state('binary_sensor.is_bedtime', 'on')
        and is_state('group.bedroom_lights', 'off')
        and (
          is_state('input_boolean.visitors', 'off')
          or (
            is_state('input_boolean.visitors', 'on') and is_state('group.guest_bedroom_lights', 'off')
          )
        )
    }}

are_master_bedroom_people_home:
  friendly_name: "Are Sarah and Nathan Home"
  device_class: occupancy
  value_template: >-
    {{ is_state('person.sarah', 'home')
      or is_state('person.nathan', 'home') }}

public_space_motion:
  friendly_name: "Public Space Motion"
  device_class: motion
  # TODO: Add other motion sensors once they're set up
  value_template: >-
    {{ is_state('binary_sensor.office_motion', 'on') }}

is_bedtime:
  value_template: >-
    {{ states('sensor.time') > states('input_datetime.bedtime')
        or states('sensor.time') < states('input_datetime.morning') }}
